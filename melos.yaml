name: spys_workspace

packages:
  - apps/**
  - packages/**

# You can run any of these with: melos run <script-name>
scripts:
  bootstrap: melos bootstrap

  pub_get: melos exec -- "flutter pub get || dart pub get"
  clean: melos exec -- "flutter clean || true"

  analyze: melos exec -- flutter analyze
  analyze:apps: |
    cd apps/mobile && flutter analyze --no-fatal-warnings
    cd ../admin_web && flutter analyze --no-fatal-warnings
  test: |
    cd packages/spys_api_client && flutter test || dart test
  format: melos exec -- dart format .
  build: |
    cd packages/spys_core && dart run build_runner build -d
    cd ../spys_api_client && flutter pub get && flutter pub run build_runner build -d

  # App-specific helpers
  run:mobile: |
    cd apps/mobile && flutter run
  run:admin_web: |
    cd apps/admin_web && flutter run -d chrome

  build:web: |
    cd apps/admin_web && flutter build web --release

  db:apply: |
    bash scripts/db_apply.sh

  smoke: |
    melos run build
    melos run analyze
    melos run test

  # Example: update a dependency across all packages
  # melos run upgrade:riverpod
  upgrade:riverpod: melos exec -- "dart pub add hooks_riverpod@^2.6.1"